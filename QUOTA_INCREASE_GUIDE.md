# üöÄ Guide d'Augmentation des Quotas Vertex AI

## ‚úÖ Modifications Appliqu√©es au Code

### Am√©lioration de la Gestion des Erreurs 429
- **D√©lais de retry augment√©s** : 5s ‚Üí 10s ‚Üí 20s ‚Üí 40s ‚Üí 80s ‚Üí 160s ‚Üí 320s
- **Nombre de tentatives** : Pass√© de 5 √† 7 retries
- **Total temps d'attente maximum** : ~10 minutes avant √©chec

### Fichier Modifi√©
- `src/lib/vertex-ai-chatbot.ts` (lignes 89, 127-129)

---

## üìä Augmenter les Quotas dans Google Cloud Console

### √âtape 1 : Acc√©der aux Quotas
1. Aller sur : https://console.cloud.google.com/iam-admin/quotas?project=omadigital23
2. Se connecter avec votre compte Google Cloud

### √âtape 2 : Filtrer les Quotas Vertex AI
Dans la barre de recherche, entrer :
```
Service: Vertex AI API
```

Ou filtrer par :
- **Service** : `aiplatform.googleapis.com`
- **Location** : `us-central1`
- **Metric** : `GenerateContent`

### √âtape 3 : Identifier les Quotas √† Augmenter

#### Quotas Critiques pour Gemini 2.0 Flash Exp :

1. **Requests per minute per model per region**
   - Quota actuel : ~10-15 RPM
   - **Demander** : 60 RPM (minimum)
   - **Id√©al** : 100 RPM

2. **Tokens per minute per model per region**
   - Quota actuel : 1,000,000 TPM
   - **Demander** : 2,000,000 TPM
   - **Id√©al** : 5,000,000 TPM

3. **Requests per day per model per region**
   - Quota actuel : 1,000 RPD
   - **Demander** : 10,000 RPD
   - **Id√©al** : 50,000 RPD

### √âtape 4 : Demander l'Augmentation

1. **Cocher** les quotas √† augmenter
2. Cliquer sur **"EDIT QUOTAS"** en haut
3. Remplir le formulaire :

#### Informations √† Fournir :
```
Project Name: omadigital23
Service: Vertex AI API (aiplatform.googleapis.com)
Location: us-central1
Model: gemini-2.0-flash-exp

Business Justification:
"Production chatbot for SME business automation platform serving 200+ clients 
in Senegal and Morocco. Real-time customer support with voice and text 
interactions. Current quota causing service disruptions during peak hours."

Technical Details:
- Average requests: 30-50 per minute during business hours
- Peak requests: 80-100 per minute
- Use case: Customer service automation, order management, FAQ responses
- Expected growth: 3x in next 6 months

Contact Email: [VOTRE EMAIL]
Phone: +221701193811
```

4. Cliquer sur **"SUBMIT REQUEST"**

### √âtape 5 : Temps de Traitement
- **R√©ponse habituelle** : 24-48 heures
- **Urgent** : Mentionner "Production impact" dans la justification

---

## üîß Solutions Temporaires (En Attendant l'Augmentation)

### 1. Utiliser Plusieurs R√©gions (Load Balancing)
Ajouter d'autres r√©gions pour distribuer la charge :
- `us-central1` (actuel)
- `europe-west1` (Europe)
- `asia-southeast1` (Asie)

### 2. Activer la Facturation
Si pas d√©j√† fait, activer un compte de facturation augmente automatiquement certains quotas.

```bash
# V√©rifier le compte de facturation
gcloud billing accounts list

# Lier le projet
gcloud billing projects link omadigital23 --billing-account=BILLING_ACCOUNT_ID
```

### 3. Passer √† un Mod√®le Stable (Si Urgent)
Si les quotas de `gemini-2.0-flash-exp` sont trop bas, consid√©rer temporairement :
- `gemini-1.5-flash` (quotas plus √©lev√©s, mod√®le stable)
- `gemini-1.5-pro` (quotas encore plus √©lev√©s)

**Note** : Le code actuel g√®re d√©j√† bien les retries, donc cette solution n'est n√©cessaire qu'en cas d'urgence absolue.

---

## üìà Monitoring des Quotas

### V√©rifier l'Utilisation Actuelle
1. Aller sur : https://console.cloud.google.com/apis/api/aiplatform.googleapis.com/quotas?project=omadigital23
2. Voir les graphiques d'utilisation en temps r√©el

### Alertes Recommand√©es
Cr√©er des alertes √† 80% d'utilisation :
1. Cloud Monitoring ‚Üí Alerting
2. Cr√©er une alerte sur `aiplatform.googleapis.com/quota/rate_quota_exceeded`

---

## ‚úÖ V√©rification Post-Augmentation

Une fois les quotas augment√©s, v√©rifier :
```bash
# Tester le chatbot
curl -X POST https://www.omadigital.net/api/chat/gemini \
  -H "Content-Type: application/json" \
  -d '{"message": "Test quota"}'
```

Surveiller les logs pour confirmer :
- ‚úÖ Pas d'erreurs 429
- ‚úÖ Temps de r√©ponse < 3 secondes
- ‚úÖ Tous les retries r√©ussissent

---

## üìû Support Google Cloud

Si la demande est rejet√©e ou prend trop de temps :
- **Support Email** : cloud-support@google.com
- **Support Chat** : https://cloud.google.com/support
- **T√©l√©phone** : Disponible avec plan de support payant

---

## üéØ R√©sum√© des Actions

1. ‚úÖ **Code modifi√©** : Retries augment√©s (5s ‚Üí 320s max)
2. üîÑ **√Ä faire** : Demander augmentation quotas dans Console
3. ‚è∞ **Attendre** : 24-48h pour approbation
4. ‚úÖ **V√©rifier** : Tester apr√®s augmentation

**Le chatbot continuera de fonctionner avec les retries am√©lior√©s, mais l'augmentation des quotas √©liminera compl√®tement les erreurs 429.**

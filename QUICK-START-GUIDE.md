# üöÄ Guide de D√©marrage Rapide - RAG-FIRST Chatbot

## ‚ö° D√©marrage en 5 Minutes

### 1. V√©rifier les Pr√©requis

```bash
# Node.js version
node --version  # Doit √™tre >= 16.x

# NPM version
npm --version   # Doit √™tre >= 8.x
```

### 2. Installer les D√©pendances

```bash
cd /c/Users/fallp/Music/OMADIGITAL
npm install
```

### 3. Configurer les Variables d'Environnement

Cr√©ez un fichier `.env.local` √† la racine du projet:

```env
# Supabase (REQUIS)
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_anon_key_here
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key_here

# Google AI (REQUIS)
GOOGLE_AI_API_KEY=your_google_ai_api_key_here

# Optional
NODE_ENV=development
```

### 4. V√©rifier la Base de Connaissances

La base de connaissances Supabase doit contenir la table `knowledge_base` avec vos 200+ entr√©es d√©j√† ins√©r√©es.

**V√©rification rapide**:
```sql
-- Dans Supabase SQL Editor
SELECT COUNT(*) FROM knowledge_base WHERE is_active = true;
-- Devrait retourner 200+
```

### 5. Lancer le Serveur de D√©veloppement

```bash
npm run dev
```

Le chatbot sera accessible sur `http://localhost:3000`

### 6. Tester le Chatbot

Ouvrez votre navigateur et testez ces questions:

**Test 1 - RAG SEUL (haute confiance)**:
```
Question: "Quels sont vos services WhatsApp ?"
R√©sultat attendu: R√©ponse directe depuis la base de connaissances
Source: rag_only
```

**Test 2 - RAG + Gemini (confiance moyenne)**:
```
Question: "Comment vous pouvez m'aider ?"
R√©sultat attendu: Gemini avec contexte RAG
Source: rag_gemini
```

**Test 3 - Gemini Fallback (question g√©n√©rale)**:
```
Question: "Quelle est la capitale du S√©n√©gal ?"
R√©sultat attendu: Gemini seul
Source: gemini_fallback
```

---

## üîß Configuration Avanc√©e

### Ajuster les Seuils de Confiance

√âditez `src/lib/rag/rag-first-service.ts`:

```typescript
class RAGFirstService {
  private readonly MIN_RAG_CONFIDENCE = 0.7;  // Modifier ici
  private readonly RAG_LIMIT = 5;              // Nombre de documents
}
```

### Modifier les Prompts Gemini

√âditez les m√©thodes dans `src/lib/rag/rag-first-service.ts`:

```typescript
private createRAGPrompt(question: string, ragContext: string, language: 'fr' | 'en'): string {
  // Personnalisez le prompt ici
}

private createGeneralPrompt(question: string, language: 'fr' | 'en'): string {
  // Personnalisez le prompt ici
}
```

### Activer/D√©sactiver le Cache RAG

√âditez `src/lib/rag/optimized-vector-search.ts`:

```typescript
private readonly CACHE_TTL = 300000; // 5 minutes (modifier ici)
private readonly MAX_CACHE_SIZE = 100; // Taille max cache
```

---

## üìä Monitoring en Production

### V√©rifier les Logs

```bash
# Logs du serveur
npm run logs

# Logs en temps r√©el
npm run logs:watch
```

### M√©triques Importantes

Surveillez ces m√©triques dans Supabase:

1. **Taux de succ√®s RAG**:
```sql
SELECT 
  source,
  COUNT(*) as count,
  AVG(confidence) as avg_confidence
FROM chatbot_conversations
WHERE created_at > NOW() - INTERVAL '24 hours'
GROUP BY source;
```

2. **Temps de r√©ponse moyen**:
```sql
SELECT 
  AVG(response_time_ms) as avg_response_time,
  MAX(response_time_ms) as max_response_time
FROM chatbot_conversations
WHERE created_at > NOW() - INTERVAL '24 hours';
```

3. **Questions fr√©quentes**:
```sql
SELECT 
  user_message,
  COUNT(*) as frequency
FROM chatbot_conversations
WHERE created_at > NOW() - INTERVAL '7 days'
GROUP BY user_message
ORDER BY frequency DESC
LIMIT 10;
```

---

## üêõ D√©pannage

### Probl√®me: "Supabase connection failed"

**Solution**:
1. V√©rifiez vos variables d'environnement
2. Testez la connexion:
```bash
curl https://your-project.supabase.co/rest/v1/knowledge_base \
  -H "apikey: your_anon_key"
```

### Probl√®me: "Gemini API error"

**Solution**:
1. V√©rifiez votre cl√© API Google AI
2. Testez l'API:
```bash
curl https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=YOUR_KEY \
  -H 'Content-Type: application/json' \
  -d '{"contents":[{"parts":[{"text":"Hello"}]}]}'
```

### Probl√®me: "No documents found in RAG"

**Solution**:
1. V√©rifiez que la table `knowledge_base` existe
2. V√©rifiez que `is_active = true` pour vos documents
3. V√©rifiez que la langue correspond (fr/en)

### Probl√®me: "Rate limit exceeded"

**Solution**:
1. Attendez 1 minute
2. R√©duisez la fr√©quence des requ√™tes
3. V√©rifiez les logs pour d√©tecter des boucles

---

## üìù Checklist de D√©ploiement

### Avant de D√©ployer en Production

- [ ] Variables d'environnement configur√©es
- [ ] Base de connaissances Supabase peupl√©e (200+ entr√©es)
- [ ] Tests end-to-end pass√©s
- [ ] Cl√© API Google AI valide
- [ ] Rate limiting configur√©
- [ ] Monitoring configur√©
- [ ] Logs activ√©s
- [ ] Backup base de connaissances cr√©√©
- [ ] Documentation √† jour
- [ ] √âquipe form√©e sur la nouvelle architecture

### Commandes de D√©ploiement

```bash
# 1. Build production
npm run build

# 2. V√©rifier le build
npm run start

# 3. D√©ployer (selon votre plateforme)
# Vercel
vercel --prod

# Netlify
netlify deploy --prod

# Custom server
pm2 start npm --name "omadigital-chatbot" -- start
```

---

## üéØ Exemples d'Utilisation

### Exemple 1: Int√©gration dans une Page

```tsx
import { SmartChatbotNext } from '@/components/SmartChatbotNext';

export default function HomePage() {
  return (
    <div>
      <h1>Bienvenue sur OMA Digital</h1>
      {/* Le chatbot s'affiche en bas √† droite */}
      <SmartChatbotNext />
    </div>
  );
}
```

### Exemple 2: Appel API Direct

```typescript
const response = await fetch('/api/chat/gemini', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    message: "Quels sont vos services ?",
    sessionId: 'unique-session-id'
  })
});

const data = await response.json();
console.log(data.response);  // R√©ponse du chatbot
console.log(data.source);    // rag_only, rag_gemini, ou gemini_fallback
console.log(data.confidence); // Score 0-1
```

### Exemple 3: Utilisation du Service RAG Directement

```typescript
import { ragFirstService } from '@/lib/rag/rag-first-service';

const result = await ragFirstService.answerQuestion(
  "Comment automatiser mon WhatsApp ?",
  {
    language: 'fr',
    limit: 5,
    similarity_threshold: 0.7
  }
);

console.log(result.answer);      // R√©ponse
console.log(result.source);      // Source
console.log(result.confidence);  // Confiance
console.log(result.documents);   // Documents RAG utilis√©s
```

---

## üìû Support

**Besoin d'aide ?**

- üìß Email: omadigital23@gmail.com
- üì± T√©l√©phone: +212 701 193 811
- üåê Site: https://omadigital.net

**Documentation**:
- Architecture: `docs/RAG-FIRST-ARCHITECTURE.md`
- Diagrammes: `docs/ARCHITECTURE-DIAGRAM.md`
- R√©sum√©: `IMPLEMENTATION-SUMMARY.md`
- Tests: `tests/rag-first.test.ts`

---

## üéâ F√©licitations !

Votre chatbot RAG-FIRST est maintenant op√©rationnel ! üöÄ

Le syst√®me utilise intelligemment:
- ‚úÖ Base de connaissances Supabase (priorit√© absolue)
- ‚úÖ Gemini avec contexte RAG (confiance moyenne)
- ‚úÖ Gemini seul (questions g√©n√©rales)
- ‚úÖ Aucun fallback m√©canique

**Prochaines √©tapes**:
1. Tester avec des questions r√©elles
2. Monitorer les performances
3. Ajuster les seuils si n√©cessaire
4. Enrichir la base de connaissances
5. Former votre √©quipe

Bon d√©veloppement ! üí™

/**
 * Script pour configurer Google Cloud Speech & TTS APIs
 * Usage: node scripts/setup-google-cloud-apis.js
 */

const fs = require('fs');
const path = require('path');

console.log('üîß Configuration Google Cloud Speech & TTS APIs...\n');

// Get API key from environment variables for security
const GOOGLE_CLOUD_API_KEY = process.env.GOOGLE_CLOUD_API_KEY || process.env.GOOGLE_AI_API_KEY;

if (!GOOGLE_CLOUD_API_KEY) {
  console.error('Error: GOOGLE_CLOUD_API_KEY or GOOGLE_AI_API_KEY environment variable not set');
  console.error('Please set one of these variables in your .env.local file');
  process.exit(1);
}

// Mettre √† jour .env.local
const envPath = path.join(__dirname, '..', '.env.local');
let envContent = '';

if (fs.existsSync(envPath)) {
  envContent = fs.readFileSync(envPath, 'utf-8');
  console.log('üìù Mise √† jour de .env.local existant');
} else {
  console.log('üìù Cr√©ation de .env.local');
}

// Fonction pour mettre √† jour ou ajouter une variable
function updateEnvVar(content, key, value) {
  const regex = new RegExp(`^${key}=.*$`, 'm');
  if (regex.test(content)) {
    return content.replace(regex, `${key}=${value}`);
  } else {
    return content + `\n${key}=${value}`;
  }
}

// Ajouter la cl√© API Google Cloud
envContent = updateEnvVar(envContent, 'GOOGLE_CLOUD_API_KEY', GOOGLE_CLOUD_API_KEY);

// √âcrire .env.local
fs.writeFileSync(envPath, envContent.trim() + '\n');
console.log('‚úÖ .env.local mis √† jour\n');

console.log('üìã Configuration termin√©e!\n');
console.log('üîë API Key configur√©e:');
console.log(`   GOOGLE_CLOUD_API_KEY=${GOOGLE_CLOUD_API_KEY.substring(0, 20)}...`);
console.log('\nüìù Cette cl√© sera utilis√©e pour:');
console.log('   ‚úÖ Google Cloud Speech-to-Text API');
console.log('   ‚úÖ Google Cloud Text-to-Speech API');
console.log('\n‚ö†Ô∏è  IMPORTANT:');
console.log('   - Cette cl√© est pour STT/TTS uniquement');
console.log('   - Vertex AI (Gemini LLM) utilise toujours Service Account');
console.log('   - Ne jamais exposer cette cl√© c√¥t√© client\n');

console.log('üöÄ Prochaines √©tapes:');
console.log('   1. Red√©marrer le serveur: npm run dev');
console.log('   2. Tester STT/TTS dans le chatbot');
console.log('   3. V√©rifier les logs: "Google Cloud Speech API"\n');
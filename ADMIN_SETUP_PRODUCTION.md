# üîê Configuration Admin en Production

## ‚ö†Ô∏è Probl√®me Actuel

Vous voyez le message **"Admin authentication misconfigured"** en production car les variables d'environnement admin ne sont pas configur√©es sur votre serveur.

---

## üìã Variables d'Environnement Requises

Vous devez ajouter ces 3 variables sur votre plateforme de d√©ploiement :

### 1. **ADMIN_USERNAME**
```
Votre nom d'utilisateur admin (exemple: admin)
```

### 2. **ADMIN_SALT**
```
Un salt hexad√©cimal al√©atoire (32 caract√®res minimum)
```

### 3. **ADMIN_PASSWORD_HASH**
```
Le hash de votre mot de passe (128 caract√®res hexad√©cimaux)
```

---

## üõ†Ô∏è Comment G√©n√©rer les Valeurs

### Option 1 : Script Node.js (Recommand√©)

Cr√©ez un fichier `generate-admin-credentials.js` :

```javascript
const crypto = require('crypto');

// Votre mot de passe souhait√©
const PASSWORD = 'VotreMotDePasseSecurise123!';

// G√©n√©rer un salt al√©atoire
const salt = crypto.randomBytes(16).toString('hex');
console.log('ADMIN_SALT=' + salt);

// G√©n√©rer le hash du mot de passe
const hash = crypto.pbkdf2Sync(PASSWORD, salt, 10000, 64, 'sha512').toString('hex');
console.log('ADMIN_PASSWORD_HASH=' + hash);

console.log('\n‚úÖ Copiez ces valeurs dans vos variables d\'environnement de production');
```

Ex√©cutez :
```bash
node generate-admin-credentials.js
```

### Option 2 : En Ligne de Commande

```bash
# G√©n√©rer le salt
node -e "console.log('ADMIN_SALT=' + require('crypto').randomBytes(16).toString('hex'))"

# G√©n√©rer le hash (remplacez VotreMotDePasse)
node -e "const crypto = require('crypto'); const salt = 'VOTRE_SALT_ICI'; const hash = crypto.pbkdf2Sync('VotreMotDePasse', salt, 10000, 64, 'sha512').toString('hex'); console.log('ADMIN_PASSWORD_HASH=' + hash)"
```

---

## üöÄ Configuration sur Vercel

### Via l'Interface Web

1. Allez sur [vercel.com](https://vercel.com)
2. S√©lectionnez votre projet **OMADIGITAL**
3. Allez dans **Settings** ‚Üí **Environment Variables**
4. Ajoutez les 3 variables :

| Name | Value | Environment |
|------|-------|-------------|
| `ADMIN_USERNAME` | `admin` (ou votre choix) | Production, Preview, Development |
| `ADMIN_SALT` | `[votre salt g√©n√©r√©]` | Production, Preview, Development |
| `ADMIN_PASSWORD_HASH` | `[votre hash g√©n√©r√©]` | Production, Preview, Development |

5. Cliquez sur **Save**
6. **Red√©ployez** votre application

### Via CLI Vercel

```bash
# Installer Vercel CLI si n√©cessaire
npm i -g vercel

# Se connecter
vercel login

# Ajouter les variables
vercel env add ADMIN_USERNAME
vercel env add ADMIN_SALT
vercel env add ADMIN_PASSWORD_HASH

# Red√©ployer
vercel --prod
```

---

## üåê Configuration sur Netlify

1. Allez sur [netlify.com](https://netlify.com)
2. S√©lectionnez votre site
3. Allez dans **Site settings** ‚Üí **Environment variables**
4. Cliquez sur **Add a variable**
5. Ajoutez les 3 variables :
   - `ADMIN_USERNAME`
   - `ADMIN_SALT`
   - `ADMIN_PASSWORD_HASH`
6. **Red√©ployez** votre site

---

## üîí S√©curit√© - Bonnes Pratiques

### ‚úÖ √Ä FAIRE :
- Utilisez un mot de passe fort (12+ caract√®res, majuscules, minuscules, chiffres, symboles)
- G√©n√©rez un nouveau salt unique pour chaque environnement
- Ne partagez JAMAIS ces valeurs publiquement
- Stockez-les dans un gestionnaire de mots de passe
- Changez le mot de passe r√©guli√®rement

### ‚ùå √Ä NE PAS FAIRE :
- Ne commitez JAMAIS ces valeurs dans Git
- Ne les envoyez pas par email non chiffr√©
- Ne les partagez pas dans des messages publics
- N'utilisez pas de mots de passe simples comme "admin123"

---

## üß™ V√©rification

### 1. V√©rifier que les Variables sont D√©finies

Ajoutez temporairement ce code dans `pages/api/admin/auth.ts` (ligne 25) :

```typescript
console.log('ENV CHECK:', {
  hasUsername: !!ADMIN_USERNAME,
  hasHash: !!ADMIN_PASSWORD_HASH,
  hasSalt: !!ADMIN_SALT,
  saltLength: ADMIN_SALT?.length,
  hashLength: ADMIN_PASSWORD_HASH?.length
});
```

### 2. Tester la Connexion

1. Allez sur `https://votre-site.com/admin/login`
2. Entrez vos identifiants
3. Si √ßa fonctionne ‚Üí ‚úÖ Configuration OK
4. Si erreur ‚Üí V√©rifiez les logs de production

---

## üêõ D√©pannage

### Erreur : "Admin authentication misconfigured"

**Cause :** Variables d'environnement manquantes ou mal format√©es

**Solution :**
1. V√©rifiez que les 3 variables sont d√©finies
2. V√©rifiez que `ADMIN_SALT` est en hexad√©cimal (32 caract√®res)
3. V√©rifiez que `ADMIN_PASSWORD_HASH` est en hexad√©cimal (128 caract√®res)
4. Red√©ployez apr√®s avoir ajout√© les variables

### Erreur : "Invalid credentials"

**Cause :** Mot de passe incorrect ou hash mal g√©n√©r√©

**Solution :**
1. R√©g√©n√©rez le hash avec le m√™me salt
2. V√©rifiez que vous utilisez le bon mot de passe
3. Assurez-vous que le salt et le hash correspondent

### Connexion OK en Local mais pas en Production

**Cause :** Variables d'environnement diff√©rentes

**Solution :**
1. V√©rifiez que les variables de production sont bien d√©finies
2. Comparez avec votre `.env.local`
3. Red√©ployez apr√®s modification

---

## üìù Exemple Complet

```bash
# 1. G√©n√©rer les credentials
node generate-admin-credentials.js

# Output:
# ADMIN_SALT=a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6
# ADMIN_PASSWORD_HASH=1234567890abcdef...

# 2. Ajouter sur Vercel
vercel env add ADMIN_USERNAME
# Entrez: admin

vercel env add ADMIN_SALT
# Collez le salt g√©n√©r√©

vercel env add ADMIN_PASSWORD_HASH
# Collez le hash g√©n√©r√©

# 3. Red√©ployer
vercel --prod

# 4. Tester
# Allez sur https://votre-site.com/admin/login
```

---

## üéØ Checklist Finale

- [ ] Variables d'environnement ajout√©es sur la plateforme
- [ ] Salt g√©n√©r√© (32 caract√®res hex minimum)
- [ ] Hash g√©n√©r√© avec le bon salt (128 caract√®res hex)
- [ ] Application red√©ploy√©e
- [ ] Connexion test√©e en production
- [ ] Credentials sauvegard√©s dans un gestionnaire de mots de passe

---

## üìû Support

Si vous avez toujours des probl√®mes :

1. V√©rifiez les logs de production
2. Testez d'abord en local avec les m√™mes credentials
3. Assurez-vous que `JWT_SECRET` est aussi d√©fini en production
4. Contactez le support de votre plateforme de d√©ploiement

---

**‚úÖ Une fois configur√©, vous pourrez vous connecter √† `/admin/login` en production !**
